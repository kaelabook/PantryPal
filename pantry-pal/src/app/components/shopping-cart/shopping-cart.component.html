<app-navbar></app-navbar>

<div class="shopping-cart-container">
  <h2 class="center-heading">Your Shopping Cart</h2>

  <!-- Flex container to show both sections side by side -->
  <div class="shopping-cart-sections">
    <!-- Left section: List of all ingredients added to the app -->
    <div class="ingredients-list">
      <h3>All Ingredients</h3>

      <!-- Search and Filter Section -->
      <div class="search-filter-wrapper">
        <div class="search-filter-container">
          <input type="text" [(ngModel)]="searchQuery" placeholder="Search Ingredients..." 
                 (input)="applySearchFilter()" class="search-bar" />
          <select [(ngModel)]="selectedCategory" (change)="applyFilter()" class="filter-dropdown">
            <option value="">Filter by Category</option>
            <option value="fruits">Fruits</option>
            <option value="vegetables">Vegetables</option>
            <option value="grains">Grains</option>
            <option value="protein">Protein</option>
            <option value="dairy">Dairy</option>
            <option value="seasonings">Seasonings</option>
            <option value="substitutions">Substitutions</option>
            <option value="misc">Miscellaneous</option>
          </select>
        </div>
      </div>

      <div class="ingredients-scroll-container">
        <table class="shopping-cart-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Quantity</th>
              <th>Unit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let ingredient of filteredIngredients; let i = index">
              <td>{{ ingredient.name }}</td>
              <td>{{ ingredient.quantity }}</td>
              <td>{{ ingredient.unit }}</td>
              <td>
                <button class="add-to-cart-btn" (click)="addToCart(i)">Add to Cart</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Right section: Current shopping cart -->
    <div class="shopping-cart">
      <h3>Shopping Cart</h3>

      <!-- Search and Filter Section for Shopping Cart -->
      <div class="cart-filter-wrapper">
        <div class="cart-filter-container">
          <input type="text" [(ngModel)]="cartSearchQuery" placeholder="Search Cart..." 
                 (input)="applyCartSearchFilter()" class="search-bar" />
          <select [(ngModel)]="selectedCartCategory" (change)="applyCartFilter()" class="filter-dropdown">
            <option value="">Filter by Category</option>
            <option value="fruits">Fruits</option>
            <option value="vegetables">Vegetables</option>
            <option value="grains">Grains</option>
            <option value="protein">Protein</option>
            <option value="dairy">Dairy</option>
            <option value="seasonings">Seasonings</option>
            <option value="substitutions">Substitutions</option>
            <option value="misc">Miscellaneous</option>
          </select>
        </div>
      </div>

      <div class="cart-scroll-container">
        <table class="shopping-cart-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Quantity</th>
              <th>Unit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of filteredCartItems; let i = index">
              <td>{{ item.name }}</td>
              <td>{{ item.quantity }}</td>
              <td>{{ item.unit }}</td>
              <td>
                <button class="edit-button" (click)="editItem(i)">Edit</button>
                <button class="delete-button" (click)="removeItem(i)">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <button class="checkout-btn" (click)="checkout()">Checkout</button>
    </div>
  </div>

  <button class="floating-button" (click)="toggleItemForm()">+</button>

  <!-- Popup form to add or edit item -->
  <div class="popup" *ngIf="showItemForm">
    <form (ngSubmit)="saveItem()">
      <h2>{{ isEditing ? 'Edit' : 'Add' }} Item</h2>

      <div class="form-container">
        <label for="itemName">Name:</label>
        <input type="text" id="itemName" [(ngModel)]="currentItem.name" name="itemName" required>

        <label for="itemQuantity">Quantity:</label>
        <input type="number" id="itemQuantity" [(ngModel)]="currentItem.quantity" name="itemQuantity" required>

        <label for="itemUnit">Unit:</label>
        <input type="text" id="itemUnit" [(ngModel)]="currentItem.unit" name="itemUnit">

        <label for="itemCategory">Category:</label>
        <select id="itemCategory" [(ngModel)]="currentItem.category" name="itemCategory">
          <option value="fruits">Fruits</option>
          <option value="vegetables">Vegetables</option>
          <option value="grains">Grains</option>
          <option value="protein">Protein</option>
          <option value="dairy">Dairy</option>
          <option value="seasonings">Seasonings</option>
          <option value="substitutions">Substitutions</option>
          <option value="misc">Miscellaneous</option>
        </select>
      </div>

      <div class="submit-row">
        <button type="button" (click)="toggleItemForm()">Cancel</button>
        <button type="submit">{{ isEditing ? 'Save' : 'Add' }} Item</button>
      </div>
    </form>
  </div>
</div>